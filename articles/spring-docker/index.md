[Docker](https://docs.docker.com) is a containerization platform that makes it possible to package, ship, and distribute applications across servers in controlled environments.
<!--more-->
### Prerequisites
1. [Java Development Kit 11](https://www.oracle.com/java/technologies/javase-jdk15-downloads.html/) or newer installed on your computer.
2. [Docker](https://docs.docker.com/docker-for-windows/install/) installed on your computer.

For Docker installation, and a quick start, visit [Getting started with Docker](/engineering-education/getting-started-with-docker/).

### Project setup
We will containerize the Todo application that we created in [this](/engineering-education/spring-boot-crud-api/) tutorial. The `Todo` application allows us to `create`, `read`, `update`, and `delete` Todo items via a REST API.

Ensure `JDK` is installed on your computer by executing the command below.

```bash
$ java --version
java 15.0.2 2021-01-19
Java(TM) SE Runtime Environment (build 15.0.2+7-27)
Java HotSpot(TM) 64-Bit Server VM (build 15.0.2+7-27, mixed mode, sharing)

```

Create a working directory for the project by executing the command below.
```bash
$ mkdir todo
$ cd todo
```
In the directory created above, clone the project from Github to your machine by executing the command below.

```bash
$ git clone https://github.com/paulodhiambo/springbootcrud.git
```
Move into the project folder by executing the command below.
```bash
$ cd springbootcrud
```
Run the application to verify if the project is correctly set up and the application runs without errors.
```bash
$ gradle build
```

Below is the project structure.
```bash
└── springbootcrud         # < project root package
    ├── src
    │   ├── main
    │   ├── test
    ├── build.gradle
    ├── gradlew
    ├── Dockerfile # Dockerfile where we write all the container build instructions
    └── gradlew.bat    
    └── settings.gradle
```

### Creating a Dockerfile
A Dockerfile is a text file containing instructions on how the Docker image will be built. A Dockerfile contains the directives below.
- **FROM**: sets the base image from which the Docker container will be built.
- **WORKDIR**: sets the working directory in the image created.
- **RUN**: executes commands in the container. 
- **COPY**: copies files from the file system into the container.
- **CMD**: sets the executable commands within the container.

In the root project folder, create a file with the name `Dockerfile`.
In the `Dockerfile` created above, add the code snippets below.

```Docker
FROM openjdk:8-jdk-alpine
RUN addgroup -S springdocker && adduser -S springdocker -G springdocker
USER springdocker:springdocker
ARG JAR_FILE=target/*.jar
COPY ${JAR_FILE} app.jar
ENTRYPOINT ["java","-jar","/app.jar"]
```

- `FROM openjdk:8-jdk-alpine` sets the base image from which the Docker container will be created.
- `RUN addgroup -S springdocker && adduser -S springdocker -G springdocker` add a user profile to the container.
- `USER springdocker:springdocker` sets the user in the container making it possible to execute commands in the container as an administrator.
- `ARG JAR_FILE=target/*.jar` sets the path to `jar` generated by `gradle build` command to `ARG_FILE` variable.
- `COPY  ${JAR_FILE} app.jar` copies the `jar` file created after running `gradle build` command to the `app.jar` file inside the docker container.
- `ENTRYPOINT ["java","-jar","/app.jar"]` indicates that the container has an executable file.

### Building the Docker image
Execute the command below to build a Docker image from the Dockerfile we have created above.

```bash
$ docker build --build-arg JAR_FILE=build/libs/\*.jar -t spring-boot-docker:latest .
```
- `--build-arg JAR_FILE=build/libs/\*.jar` sets the path to the `jar` file generated by running `gradle build` command.
- `-t` sets the tag for the image. For example, we are creating a Docker image from `openjdk:8-jdk-alpine` that has the tag `8-jdk-alpine`. We have set `latest` as the tag in our Docker image.
- The trailing `.` shows that the `Dockerfile` is within the current directory.
  
Execute the command below to list all the Docker images available on your computer.
```bash
$ docker image ls
REPOSITORY    TAG            IMAGE ID       CREATED         SIZE
spring-boot-docker               latest              b7a1056c3eb2   31 minutes ago   143MB
springio/gs-spring-boot-docker   latest              b7a1056c3eb2   31 minutes ago   143MB
<none>                           <none>              4f8c8633df3e   2 days ago       105MB
latest                           latest              6c802830c996   4 weeks ago      414MB

```

From the above list, we see the `spring-boot-docker` image that we have created.

### Creating and running the Docker Container
Execute the command below to build and run a Docker container from the Docker image we created above.

```bash
$ docker run --name spring-boot-docker -d -p 8080:8080 spring-boot-docker:latest
```
- `--name` flag sets the Docker container name.
- `-d` flag makes the image run in detached mode, running in the background.
- `-p 8080:8080` maps port 8080 in the Docker container to port 8080 in localhost.
- `spring-boot-docker:latest` specifies which image is used to build the Docker container. 

Execute the command below to list all the running Docker containers.
```bash
$ docker container ps
CONTAINER ID   IMAGE                   COMMAND                  CREATED       STATUS       PORTS                        NAMES
792fce534e3a   spring-boot-docker   "java -jar /app.jar"   31 minutes ago   Up 31 minutes   0.0.0.0:8080->8080/tcp   spring-boot-docker

```

1. On your browser visit `localhost` on port 8000 to confirm if the `spring-boot-crud` application is running in the container.
![Docker Hub image](/engineering-education/spring-docker/docker_get.png)

### Publishing the Docker image to Docker Hub
![Docker Hub image](/engineering-education/spring-docker/docker_create.png)

Docker Hub is a repository of container images. Docker hub stores Docker containers and also makes it easy to share Docker images with other developers.

Create a Docker Hub account [here](https://hub.docker.com/) if you don't have one.

Once you have created an account and logged in to Docker Hub, create a repository with the name `spring-boot-crud` and the description `Spring Boot Docker Image`.

Execute the command below to push the Docker image to the repository that we have created in the Docker Hub.

```bash
$ docker login

$ docker tag spring-boot-docker:latest <Docker Hub username>/spring-boot-docker:latest

$ docker push <Docker Hub username>/spring-boot-docker:latest
```

- `docker login` command authenticates you into your Docker Hub account on the command line, making it possible to push Docker images to Docker Hub.
- `docker tag spring-boot-docker: latest <Docker Hub username>/spring-boot-docker: latest` command modifies the tag of our local Docker image to include the Docker Hub username.
- `docker push <Docker Hub username>/spring-boot-docker: latest` pushes the image to Docker Hub repository we created earlier.

**Note:** Replace `<Docker Hub username>` with your actual Docker Hub username.

The source code to the application is in [this](https://github.com/paulodhiambo/django_todo/tree/token_auth) GitHub repository.

### Conclusion
Docker is a good tool for packaging applications with the required dependencies to run them both locally and in production. [Docker playground](https://labs.play-with-docker.com/) is an online environment that you can use to test various Docker commands without installing Docker locally on your computer.

Happy Coding!